import { writable } from "svelte/store";
import { client } from 'api/http'

function createUser() {
  const state = {
    token: localStorage.getItem("ukanlearn_access_token") || null,
  };

  const { set, update, subscribe } = writable(state);

  return {
    set,
    update,
    subscribe,
    /**
     * 
     * @param {string} email 
     * @param {string} password 
     */
    async login(email, password) {
      try {
        const r = await client.post('/login', {
          email,password
        })
        if (r.data.access_token) {
          update(n => ({...n, token: r.data.access_token}))
        }
        return null
      } catch (error) {
        return error
      }
    }
  };
}

export const user = createUser();
